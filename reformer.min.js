(function(){var jade=function(e){function t(e){return e!=null}return Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),e.merge=function(n,r){var i=n["class"],s=r["class"];if(i||s)i=i||[],s=s||[],Array.isArray(i)||(i=[i]),Array.isArray(s)||(s=[s]),i=i.filter(t),s=s.filter(t),n["class"]=i.concat(s).join(" ");for(var o in r)o!="class"&&(n[o]=r[o]);return n},e.attrs=function(n,r){var i=[],s=n.terse;delete n.terse;var o=Object.keys(n),u=o.length;if(u){i.push("");for(var a=0;a<u;++a){var f=o[a],l=n[f];"boolean"==typeof l||null==l?l&&(s?i.push(f):i.push(f+'="'+f+'"')):0==f.indexOf("data")&&"string"!=typeof l?i.push(f+"='"+JSON.stringify(l)+"'"):"class"==f&&Array.isArray(l)?i.push(f+'="'+e.escape(l.join(" "))+'"'):r&&r[f]?i.push(f+'="'+e.escape(l)+'"'):i.push(f+'="'+l+'"')}}return i.join(" ")},e.escape=function(t){return String(t).replace(/&(?!(\w+|\#\d+);)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.rethrow=function(t,n,r){if(!n)throw t;var i=3,s=require("fs").readFileSync(n,"utf8"),o=s.split("\n"),u=Math.max(r-i,0),a=Math.min(o.length,r+i),i=o.slice(u,a).map(function(e,t){var n=t+u+1;return(n==r?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+r+"\n"+i+"\n\n"+t.message,t},e}({}),template=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp,__indent=[],ifDef=function(e){return typeof e!="undefined"?e:""};buf.push("\n<form"),buf.push(attrs({id:ifDef(id)+"_form"},{id:!0})),buf.push(">"),function(){if("number"==typeof fields.length)for(var e=0,t=fields.length;e<t;e++){var n=fields[e],r=typeof n.id!="undefined"?n.id:n.name;buf.push("\n  <div"),buf.push(attrs({id:r+"_parent","class":"fieldContainer clearfix"},{id:!0})),buf.push(">"),function(){if("number"==typeof n.errors.length)for(var e=0,t=n.errors.length;e<t;e++){var r=n.errors[e];buf.push('<span class="error">');var i=r;buf.push(null==i?"":i),buf.push("</span>")}else for(var e in n.errors){var r=n.errors[e];buf.push('<span class="error">');var i=r;buf.push(null==i?"":i),buf.push("</span>")}}.call(this);if(n.label){buf.push("\n    <label"),buf.push(attrs({"for":r},{"for":!0})),buf.push(">");var i=n.label;buf.push(escape(null==i?"":i)),buf.push("</label>")}n.textarea&&(buf.push("\n    <textarea"),buf.push(attrs({id:r},{id:!0})),buf.push("></textarea>")),n.input&&(buf.push("\n    <input"),buf.push(attrs({id:r,min:ifDef(n.min),max:typeof n.max!="undefined"?max:null,step:typeof n.step!="undefined"?step:null,placeholder:n.placeholder,type:n.type,name:n.name,value:n.value},{id:!0,min:!0,max:!0,step:!0,placeholder:!0,type:!0,name:!0,value:!0})),buf.push("/>")),n.select&&(buf.push("\n    <select"),buf.push(attrs({id:r,name:n.name,"class":n.class},{id:!0,name:!0,"class":!0})),buf.push(">"),function(){if("number"==typeof n.options.length)for(var e=0,t=n.options.length;e<t;e++){var r=n.options[e];buf.push("\n      <option"),buf.push(attrs({value:r.val},{value:!0})),buf.push(">");var i=r.text;buf.push(escape(null==i?"":i)),buf.push("</option>")}else for(var e in n.options){var r=n.options[e];buf.push("\n      <option"),buf.push(attrs({value:r.val},{value:!0})),buf.push(">");var i=r.text;buf.push(escape(null==i?"":i)),buf.push("</option>")}}.call(this),buf.push("\n    </select>")),n.helptext&&(buf.push("\n    <p"),buf.push(attrs({id:r+"_helptext","class":"helptext"},{id:!0})),buf.push("></p>")),buf.push("\n  </div>")}else for(var e in fields){var n=fields[e],r=typeof n.id!="undefined"?n.id:n.name;buf.push("\n  <div"),buf.push(attrs({id:r+"_parent","class":"fieldContainer clearfix"},{id:!0})),buf.push(">"),function(){if("number"==typeof n.errors.length)for(var e=0,t=n.errors.length;e<t;e++){var r=n.errors[e];buf.push('<span class="error">');var i=r;buf.push(null==i?"":i),buf.push("</span>")}else for(var e in n.errors){var r=n.errors[e];buf.push('<span class="error">');var i=r;buf.push(null==i?"":i),buf.push("</span>")}}.call(this);if(n.label){buf.push("\n    <label"),buf.push(attrs({"for":r},{"for":!0})),buf.push(">");var i=n.label;buf.push(escape(null==i?"":i)),buf.push("</label>")}n.textarea&&(buf.push("\n    <textarea"),buf.push(attrs({id:r},{id:!0})),buf.push("></textarea>")),n.input&&(buf.push("\n    <input"),buf.push(attrs({id:r,min:ifDef(n.min),max:typeof n.max!="undefined"?max:null,step:typeof n.step!="undefined"?step:null,placeholder:n.placeholder,type:n.type,name:n.name,value:n.value},{id:!0,min:!0,max:!0,step:!0,placeholder:!0,type:!0,name:!0,value:!0})),buf.push("/>")),n.select&&(buf.push("\n    <select"),buf.push(attrs({id:r,name:n.name,"class":n.class},{id:!0,name:!0,"class":!0})),buf.push(">"),function(){if("number"==typeof n.options.length)for(var e=0,t=n.options.length;e<t;e++){var r=n.options[e];buf.push("\n      <option"),buf.push(attrs({value:r.val},{value:!0})),buf.push(">");var i=r.text;buf.push(escape(null==i?"":i)),buf.push("</option>")}else for(var e in n.options){var r=n.options[e];buf.push("\n      <option"),buf.push(attrs({value:r.val},{value:!0})),buf.push(">");var i=r.text;buf.push(escape(null==i?"":i)),buf.push("</option>")}}.call(this),buf.push("\n    </select>")),n.helptext&&(buf.push("\n    <p"),buf.push(attrs({id:r+"_helptext","class":"helptext"},{id:!0})),buf.push("></p>")),buf.push("\n  </div>")}}.call(this),buf.push('\n  <div class="clearfix"></div>\n  <button type="submit" class="submit">');var __val__=typeof submitText!="undefined"?submitText:"Submit";buf.push(escape(null==__val__?"":__val__)),buf.push('</button>\n  <button type="reset" class="cancel">');var __val__=typeof cancelText!="undefined"?cancelText:"Cancel";buf.push(escape(null==__val__?"":__val__)),buf.push("</button>\n</form>")}return buf.join("")},Reformer=function(e){var t=function(){},n;this.settings={error:t,submit:t,reqMessage:"This field is required",html5Validation:!0},this.fields=e.fields,this.id=e.id,this.submitText=e.submitText,this.initialData=e.data||{},delete e.fields;for(n in e)this.settings[n]=e[n];this.fields.forEach(function(t){var n={errors:[],type:"text",tests:[],textarea:t.widget==="textarea",select:t.widget==="select"&&t.hasOwnProperty("options"),input:t.hasOwnProperty("widget")?t.widget==="input":!0,trim:!0},r;for(r in n)t.hasOwnProperty(r)||(t[r]=n[r]);e.data&&e.data.hasOwnProperty(t.name)?t.value=t.initial=e.data[t.name]:t.value=t.initial=""})};Reformer.prototype.render=function(){var e=this;return this.dom?this.dom.innerHTML=this.domify(template(this)).innerHTML:(this.dom=this.domify(template(this)),this.dom.addEventListener("submit",function(e){e.preventDefault()},!0),this.dom.addEventListener("input",function(t){e.handleInputChange.apply(e,arguments)},!0),this.dom.addEventListener("blur",function(t){e.handleInputChange.apply(e,arguments)},!0),this.dom.addEventListener("change",function(t){e.handleInputChange.apply(e,arguments)},!0),this.dom.addEventListener("invalid",function(e){e.preventDefault()},!0)),this.storeDomRef(),this.fields.forEach(function(e){e.type==="select"&&e.value&&(e.inputEl.value=e.value+"")}),this.addButtonHandlers(),this.dom},Reformer.prototype.addButtonHandlers=function(){var e=this,t=this.dom.getElementsByTagName("button",this.dom),n=0,r=t.length;for(;n<r;n++)t[n].addEventListener("click",function(t){var n=t.target.className,r;if(e.submitRe.test(n))return e.handleSubmit(),t.stopPropagation(),!1;r=e.settings[n];if(r)return t.preventDefault(),t.stopPropagation(),r(),!1},!0)},Reformer.prototype.handleSubmit=function(e){var t=this;t.settings.preSubmit&&t.settings.preSubmit.call(t),this.validate(function(e){if(e){var n=t.data();t.settings.submit(n,t.diffData(n))}else t.settings.error(t);t.render()})},Reformer.prototype.data=function(){var e={};return this.fields.forEach(function(t){e[t.name]=t.trim&&t.value.trim?t.value.trim():t.value}),this.settings.clean&&(e=this.settings.clean(e)),e},Reformer.prototype.diffData=function(e){var t=this.initialData,n={},r;for(var i in e)e[i]!==t[i]&&(r=!0,n[i]=e[i]);return r?n:undefined},Reformer.prototype.handleInputChange=function(e){var t=e.target,n=t.field.type;t.field.value=function(){return["range","number"].indexOf(n)!==-1?t.valueAsNumber:n==="date"?t.valueAsDate:t.value}()},Reformer.prototype.clearAll=function(){return this.fields.forEach(function(e){e.inputEl.value="",e.errors=[]}),!0},Reformer.prototype.validate=function(e){var t=this,n=!0;this.asyncForEach(this.fields,function(e,r){var i=e.tests instanceof Array?e.tests:[e.tests];e.errors=[],e.required&&(!e.value||e.value.length===0)&&(n=!1,e.errors.push(e.reqMessage||t.settings.reqMessage)),t.settings.html5Validation&&e.inputEl.validationMessage&&(n=!1,e.errors.push(e.inputEl.validationMessage)),t.asyncForEach(i,function(r,i){var s=!1;r.ignoreSame&&e.value===e.initial?i(null):r.async?r.test.call(t,e.value,t,function(t){t||(n=!1,e.errors.push(r.message)),i(null,t)}):(s=r.test.call(t,e.value,t),s||(n=!1,e.errors.push(r.message)),i(null,s))},r)},function(){e(n)})},Reformer.prototype.storeDomRef=function(){var e=this;this.fields.forEach(function(t){t.inputEl=e.dom.querySelector('[name="'+t.name+'"]'),t.inputEl.field=t,t.labelEl=e.dom.querySelector('label[for="'+t.id+'"]')})},Reformer.prototype.domify=function(e){var t=document.createElement("div");return t.innerHTML=e,t.querySelector("form")},Reformer.prototype.asyncForEach=function(e,t,n){if(!e.length)return n();var r=0;e.forEach(function(i){t(i,function(t){t?(n(t),n=function(){}):(r+=1,r===e.length&&n())})})},Reformer.prototype.submitRe=/(^|\s)submit(\s|$)/,Reformer.prototype.cancelRe=/(^|\s)cancel(\s|$)/,window.Reformer=Reformer})(window)